<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>里昂邮政集团</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            min-height: 100vh;
            background-image: url('');
            background-size: cover;
            background-attachment: fixed;
            background-position: center;
            transition: background-image 0.5s ease;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* 头部样式 */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: rgba(0, 51, 102, 0.95);
            color: white;
            padding: 15px 30px;
            border-radius: 10px 10px 0 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-img {
            width: 75px;
            height: 75px;
            border-radius: 8px;
            object-fit: cover;
            cursor: pointer;
            border: 2px solid rgba(255, 255, 255, 0.3);
            transition: transform 0.3s;
        }
        
        .logo-img:hover {
            transform: scale(1.05);
        }
        
        .logo-text h1 {
            font-size: 28px;
            font-weight: 700;
            letter-spacing: 1px;
        }
        
        .logo-text p {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        /* 标签页导航 */
        .tabs {
            display: flex;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        
        .tab {
            flex: 1;
            text-align: center;
            padding: 15px 5px;
            cursor: pointer;
            font-weight: 600;
            color: #003366;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .tab:hover {
            background-color: rgba(0, 51, 102, 0.05);
        }
        
        .tab.active {
            background-color: rgba(0, 51, 102, 0.1);
            border-bottom: 3px solid #003366;
        }
        
        /* 标签内容区域 */
        .tab-content {
            display: none;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            min-height: 500px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .tab-content h2 {
            color: #003366;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        /* 图片显示区域 */
        .images-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .image-item {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .image-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        
        .image-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            cursor: pointer;
            display: block;
        }
        
        .image-info {
            padding: 15px;
        }
        
        .image-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #003366;
        }
        
        .image-date {
            font-size: 13px;
            color: #777;
        }
        
        /* 按钮样式 */
        .actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: #003366;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #002244;
        }
        
        .btn-secondary {
            background-color: #f0f0f0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background-color: #e0e0e0;
        }
        
        .btn-danger {
            background-color: #d9534f;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #c9302c;
        }
        
        /* 弹窗样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            color: #003366;
            font-size: 22px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #777;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #003366;
        }
        
        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
        }
        
        .form-control:focus {
            outline: none;
            border-color: #003366;
        }
        
        .password-prompt {
            text-align: center;
            padding: 20px 0;
        }
        
        .password-prompt h3 {
            margin-bottom: 15px;
            color: #003366;
        }
        
        /* 设置页面样式 */
        .settings-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
        }
        
        .setting-section {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        
        .setting-section h3 {
            color: #003366;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .current-image {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .current-image img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            cursor: pointer;
            border: 1px solid #ddd;
        }
        
        .current-image p {
            margin-top: 10px;
            color: #777;
            font-size: 14px;
        }
        
        /* 图片放大查看 */
        .image-viewer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            display: none;
        }
        
        .image-viewer.active {
            display: flex;
        }
        
        .viewer-content {
            max-width: 90%;
            max-height: 90%;
        }
        
        .viewer-content img {
            max-width: 100%;
            max-height: 90vh;
            border-radius: 5px;
        }
        
        .close-viewer {
            position: absolute;
            top: 20px;
            right: 30px;
            background: none;
            border: none;
            color: white;
            font-size: 30px;
            cursor: pointer;
        }
        
        /* 空状态提示 */
        .empty-state {
            text-align: center;
            padding: 50px 20px;
            color: #777;
        }
        
        .empty-state i {
            font-size: 60px;
            margin-bottom: 20px;
            color: #ccc;
        }
        
        .empty-state h3 {
            margin-bottom: 10px;
            color: #003366;
        }
        
        /* 响应式设计 */
        @media (max-width: 768px) {
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 0 0 50%;
                padding: 12px 5px;
                font-size: 14px;
            }
            
            .images-container {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 15px;
            }
            
            .settings-container {
                grid-template-columns: 1fr;
            }
            
            header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }
        
        @media (max-width: 480px) {
            .tab {
                flex: 0 0 100%;
            }
            
            .images-container {
                grid-template-columns: 1fr;
            }
            
            .actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 头部 -->
        <header>
            <div class="logo-container">
                <img id="logo-img" src="" alt="里昂邮政集团LOGO" class="logo-img">
                <div class="logo-text">
                    <h1>里昂邮政集团</h1>
                    <p>LYON POSTAL GROUP</p>
                </div>
            </div>
            <div class="current-date" id="current-date">
                <!-- 当前日期和时间将通过JavaScript动态生成 -->
            </div>
        </header>
        
        <!-- 标签页导航 -->
        <div class="tabs">
            <div class="tab active" data-tab="announcement">公告</div>
            <div class="tab" data-tab="business">业务介绍</div>
            <div class="tab" data-tab="branches">网点清单</div>
            <div class="tab" data-tab="pricing">资费清单</div>
            <div class="tab" data-tab="postage">邮资清单</div>
            <div class="tab" data-tab="products">邮品清单</div>
            <div class="tab" data-tab="settings">设置</div>
            <div class="tab" data-tab="stamp">戳戳我</div>
        </div>
        
        <!-- 公告标签页 -->
        <div id="announcement" class="tab-content active">
            <h2><i class="fas fa-bullhorn"></i> 公告</h2>
            <div id="announcement-images" class="images-container">
                <!-- 公告图片将通过JavaScript动态生成 -->
                <div class="empty-state">
                    <i class="far fa-newspaper"></i>
                    <h3>暂无公告</h3>
                    <p>点击下方按钮上传公告图片</p>
                </div>
            </div>
            <div class="actions">
                <button class="btn btn-primary" id="add-announcement-btn">
                    <i class="fas fa-upload"></i> 上传公告
                </button>
            </div>
        </div>
        
        <!-- 业务介绍标签页 -->
        <div id="business" class="tab-content">
            <h2><i class="fas fa-briefcase"></i> 业务介绍</h2>
            <div id="business-images" class="images-container">
                <div class="empty-state">
                    <i class="fas fa-project-diagram"></i>
                    <h3>暂无业务介绍</h3>
                    <p>点击下方按钮上传业务介绍图片</p>
                </div>
            </div>
            <div class="actions">
                <button class="btn btn-primary" id="add-business-btn">
                    <i class="fas fa-upload"></i> 上传业务介绍
                </button>
            </div>
        </div>
        
        <!-- 网点清单标签页 -->
        <div id="branches" class="tab-content">
            <h2><i class="fas fa-map-marker-alt"></i> 网点清单</h2>
            <div id="branches-images" class="images-container">
                <div class="empty-state">
                    <i class="fas fa-store"></i>
                    <h3>暂无网点信息</h3>
                    <p>点击下方按钮上传网点清单图片</p>
                </div>
            </div>
            <div class="actions">
                <button class="btn btn-primary" id="add-branches-btn">
                    <i class="fas fa-upload"></i> 上传网点清单
                </button>
            </div>
        </div>
        
        <!-- 资费清单标签页 -->
        <div id="pricing" class="tab-content">
            <h2><i class="fas fa-money-bill-wave"></i> 资费清单</h2>
            <div id="pricing-images" class="images-container">
                <div class="empty-state">
                    <i class="fas fa-file-invoice-dollar"></i>
                    <h3>暂无资费信息</h3>
                    <p>点击下方按钮上传资费清单图片</p>
                </div>
            </div>
            <div class="actions">
                <button class="btn btn-primary" id="add-pricing-btn">
                    <i class="fas fa-upload"></i> 上传资费清单
                </button>
            </div>
        </div>
        
        <!-- 邮资清单标签页 -->
        <div id="postage" class="tab-content">
            <h2><i class="fas fa-stamp"></i> 邮资清单</h2>
            <div id="postage-images" class="images-container">
                <div class="empty-state">
                    <i class="fas fa-envelope"></i>
                    <h3>暂无邮资信息</h3>
                    <p>点击下方按钮上传邮资清单图片</p>
                </div>
            </div>
            <div class="actions">
                <button class="btn btn-primary" id="add-postage-btn">
                    <i class="fas fa-upload"></i> 上传邮资清单
                </button>
            </div>
        </div>
        
        <!-- 邮品清单标签页 -->
        <div id="products" class="tab-content">
            <h2><i class="fas fa-box-open"></i> 邮品清单</h2>
            <div id="products-images" class="images-container">
                <div class="empty-state">
                    <i class="fas fa-gift"></i>
                    <h3>暂无邮品信息</h3>
                    <p>点击下方按钮上传邮品清单图片</p>
                </div>
            </div>
            <div class="actions">
                <button class="btn btn-primary" id="add-products-btn">
                    <i class="fas fa-upload"></i> 上传邮品清单
                </button>
            </div>
        </div>
        
        <!-- 设置标签页 -->
        <div id="settings" class="tab-content">
            <h2><i class="fas fa-cog"></i> 设置</h2>
            <div class="settings-container">
                <div class="setting-section">
                    <h3>LOGO设置</h3>
                    <div class="current-image">
                        <img id="current-logo" src="" alt="当前LOGO">
                        <p>当前LOGO，尺寸：75×75px</p>
                    </div>
                    <div class="actions">
                        <button class="btn btn-primary" id="upload-logo-btn">
                            <i class="fas fa-upload"></i> 上传LOGO
                        </button>
                        <button class="btn btn-danger" id="delete-logo-btn">
                            <i class="fas fa-trash"></i> 删除LOGO
                        </button>
                    </div>
                </div>
                
                <div class="setting-section">
                    <h3>背景设置</h3>
                    <div class="current-image">
                        <img id="current-background" src="" alt="当前背景">
                        <p>当前背景图片</p>
                    </div>
                    <div class="actions">
                        <button class="btn btn-primary" id="upload-background-btn">
                            <i class="fas fa-upload"></i> 上传背景
                        </button>
                        <button class="btn btn-danger" id="delete-background-btn">
                            <i class="fas fa-trash"></i> 删除背景
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 戳戳我标签页 -->
        <div id="stamp" class="tab-content">
            <h2><i class="fas fa-heart"></i> 戳戳我</h2>
            <div id="stamp-images" class="images-container">
                <div class="empty-state">
                    <i class="fas fa-smile-wink"></i>
                    <h3>暂无戳戳我内容</h3>
                    <p>点击下方按钮上传图片</p>
                </div>
            </div>
            <div class="actions">
                <button class="btn btn-primary" id="add-stamp-btn">
                    <i class="fas fa-upload"></i> 上传图片
                </button>
            </div>
        </div>
    </div>
    
    <!-- 图片查看器 -->
    <div class="image-viewer" id="image-viewer">
        <button class="close-viewer" id="close-viewer">&times;</button>
        <div class="viewer-content">
            <img id="viewed-image" src="" alt="查看的图片">
        </div>
    </div>
    
    <!-- 密码验证弹窗 -->
    <div class="modal" id="password-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">管理密码验证</h3>
                <button class="close-modal" id="close-password-modal">&times;</button>
            </div>
            <div class="password-prompt">
                <h3>请输入管理密码</h3>
                <div class="form-group">
                    <input type="password" id="password-input" class="form-control" placeholder="请输入密码">
                </div>
                <p id="password-error" style="color: #d9534f; margin-top: 10px; display: none;">密码错误，请重试</p>
                <div class="actions">
                    <button class="btn btn-primary" id="submit-password">确认</button>
                    <button class="btn btn-secondary" id="cancel-password">取消</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 上传弹窗 -->
    <div class="modal" id="upload-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="upload-title">上传图片</h3>
                <button class="close-modal" id="close-upload-modal">&times;</button>
            </div>
            <form id="upload-form">
                <div class="form-group">
                    <label for="image-title">图片标题 (仅公告需要)</label>
                    <input type="text" id="image-title" class="form-control" placeholder="请输入图片标题">
                </div>
                <div class="form-group">
                    <label for="image-upload">选择图片 (最多5张，支持JPG、JPEG、PNG格式)</label>
                    <input type="file" id="image-upload" class="form-control" accept=".jpg,.jpeg,.png" multiple>
                    <p id="image-count" style="margin-top: 8px; color: #777; font-size: 14px;">最多可选择5张图片</p>
                </div>
                <div class="actions">
                    <button type="submit" class="btn btn-primary">上传</button>
                    <button type="button" class="btn btn-secondary" id="cancel-upload">取消</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- 修改/删除弹窗 -->
    <div class="modal" id="edit-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">管理项目</h3>
                <button class="close-modal" id="close-edit-modal">&times;</button>
            </div>
            <div id="edit-content">
                <!-- 修改/删除内容将动态生成 -->
            </div>
        </div>
    </div>

    <script>
        // 密码常量
        const ADMIN_PASSWORD = "740302";
        
        // 当前状态变量
        let currentTab = "announcement";
        let currentUploadType = "";
        let editingItemId = null;
        let passwordVerified = false;
        
        // 从localStorage加载数据
        let appData = {
            announcement: [],  // {id, image, title, date}
            business: [],      // {id, image, date}
            branches: [],      // {id, image, date}
            pricing: [],       // {id, image, date}
            postage: [],       // {id, image, date}
            products: [],      // {id, image, date}
            stamp: [],         // {id, image, date}
            logo: "",
            background: ""
        };
        
        // 初始化函数
        function initApp() {
            // 从localStorage加载数据
            loadData();
            
            // 设置当前日期时间
            updateCurrentDateTime();
            setInterval(updateCurrentDateTime, 1000);
            
            // 恢复上次的标签页
            const savedTab = localStorage.getItem("lyonPostal_currentTab");
            if (savedTab) {
                switchTab(savedTab);
            }
            
            // 设置事件监听器
            setupEventListeners();
            
            // 加载图片
            renderAllImages();
            
            // 加载LOGO和背景
            loadLogoAndBackground();
        }
        
        // 加载数据
        function loadData() {
            const savedData = localStorage.getItem("lyonPostal_data");
            if (savedData) {
                appData = JSON.parse(savedData);
            }
        }
        
        // 保存数据
        function saveData() {
            localStorage.setItem("lyonPostal_data", JSON.stringify(appData));
        }
        
        // 更新当前日期时间
        function updateCurrentDateTime() {
            const now = new Date();
            const dateElement = document.getElementById("current-date");
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');
            
            dateElement.innerHTML = `
                <div style="font-size: 18px; font-weight: 600;">${year}年${month}月${day}日</div>
                <div style="font-size: 16px; margin-top: 5px;">${hours}:${minutes}:${seconds}</div>
            `;
        }
        
        // 设置事件监听器
        function setupEventListeners() {
            // 标签页切换
            document.querySelectorAll(".tab").forEach(tab => {
                tab.addEventListener("click", () => {
                    const tabId = tab.getAttribute("data-tab");
                    switchTab(tabId);
                });
            });
            
            // 图片上传按钮
            document.getElementById("add-announcement-btn").addEventListener("click", () => openUploadModal("announcement"));
            document.getElementById("add-business-btn").addEventListener("click", () => openUploadModal("business"));
            document.getElementById("add-branches-btn").addEventListener("click", () => openUploadModal("branches"));
            document.getElementById("add-pricing-btn").addEventListener("click", () => openUploadModal("pricing"));
            document.getElementById("add-postage-btn").addEventListener("click", () => openUploadModal("postage"));
            document.getElementById("add-products-btn").addEventListener("click", () => openUploadModal("products"));
            document.getElementById("add-stamp-btn").addEventListener("click", () => openUploadModal("stamp"));
            
            // 设置页面上传按钮
            document.getElementById("upload-logo-btn").addEventListener("click", () => openLogoUpload());
            document.getElementById("upload-background-btn").addEventListener("click", () => openBackgroundUpload());
            document.getElementById("delete-logo-btn").addEventListener("click", () => deleteLogo());
            document.getElementById("delete-background-btn").addEventListener("click", () => deleteBackground());
            
            // 密码验证
            document.getElementById("submit-password").addEventListener("click", verifyPassword);
            document.getElementById("cancel-password").addEventListener("click", closePasswordModal);
            document.getElementById("close-password-modal").addEventListener("click", closePasswordModal);
            document.getElementById("password-input").addEventListener("keypress", (e) => {
                if (e.key === "Enter") {
                    verifyPassword();
                }
            });
            
            // 上传表单
            document.getElementById("upload-form").addEventListener("submit", handleUpload);
            document.getElementById("cancel-upload").addEventListener("click", closeUploadModal);
            document.getElementById("close-upload-modal").addEventListener("click", closeUploadModal);
            
            // 图片查看器
            document.getElementById("close-viewer").addEventListener("click", () => {
                document.getElementById("image-viewer").classList.remove("active");
            });
            
            // 编辑弹窗关闭
            document.getElementById("close-edit-modal").addEventListener("click", closeEditModal);
            
            // 图片上传限制
            document.getElementById("image-upload").addEventListener("change", function() {
                const maxFiles = 5;
                if (this.files.length > maxFiles) {
                    alert(`最多只能上传${maxFiles}张图片`);
                    this.value = "";
                }
            });
        }
        
        // 切换标签页
        function switchTab(tabId) {
            // 更新标签样式
            document.querySelectorAll(".tab").forEach(tab => {
                tab.classList.remove("active");
            });
            document.querySelector(`[data-tab="${tabId}"]`).classList.add("active");
            
            // 更新内容显示
            document.querySelectorAll(".tab-content").forEach(content => {
                content.classList.remove("active");
            });
            document.getElementById(tabId).classList.add("active");
            
            // 保存当前标签页
            currentTab = tabId;
            localStorage.setItem("lyonPostal_currentTab", tabId);
        }
        
        // 打开上传弹窗
        function openUploadModal(type) {
            currentUploadType = type;
            
            // 设置弹窗标题
            const titles = {
                announcement: "上传公告",
                business: "上传业务介绍",
                branches: "上传网点清单",
                pricing: "上传资费清单",
                postage: "上传邮资清单",
                products: "上传邮品清单",
                stamp: "上传戳戳我图片"
            };
            
            document.getElementById("upload-title").textContent = titles[type] || "上传图片";
            
            // 如果是公告，显示标题输入框，否则隐藏
            const titleInput = document.getElementById("image-title").parentElement;
            titleInput.style.display = type === "announcement" ? "block" : "none";
            
            // 重置表单
            document.getElementById("upload-form").reset();
            
            // 显示密码弹窗
            openPasswordModal();
        }
        
        // 打开LOGO上传
        function openLogoUpload() {
            openPasswordModal("logo");
        }
        
        // 打开背景上传
        function openBackgroundUpload() {
            openPasswordModal("background");
        }
        
        // 打开密码弹窗
        function openPasswordModal(type) {
            if (type) {
                currentUploadType = type;
            }
            
            document.getElementById("password-modal").classList.add("active");
            document.getElementById("password-input").focus();
            document.getElementById("password-error").style.display = "none";
            passwordVerified = false;
        }
        
        // 关闭密码弹窗
        function closePasswordModal() {
            document.getElementById("password-modal").classList.remove("active");
            document.getElementById("password-input").value = "";
        }
        
        // 验证密码
        function verifyPassword() {
            const password = document.getElementById("password-input").value;
            const errorElement = document.getElementById("password-error");
            
            if (password === ADMIN_PASSWORD) {
                passwordVerified = true;
                closePasswordModal();
                
                // 根据类型打开相应弹窗
                if (["logo", "background"].includes(currentUploadType)) {
                    openImageUploadForSetting();
                } else {
                    document.getElementById("upload-modal").classList.add("active");
                }
            } else {
                errorElement.style.display = "block";
                document.getElementById("password-input").value = "";
                document.getElementById("password-input").focus();
            }
        }
        
        // 打开设置图片上传
        function openImageUploadForSetting() {
            if (currentUploadType === "logo") {
                const input = document.createElement("input");
                input.type = "file";
                input.accept = ".jpg,.jpeg,.png";
                input.onchange = function(e) {
                    if (e.target.files && e.target.files[0]) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            appData.logo = event.target.result;
                            saveData();
                            loadLogoAndBackground();
                            alert("LOGO上传成功！");
                        };
                        reader.readAsDataURL(e.target.files[0]);
                    }
                };
                input.click();
            } else if (currentUploadType === "background") {
                const input = document.createElement("input");
                input.type = "file";
                input.accept = ".jpg,.jpeg,.png";
                input.onchange = function(e) {
                    if (e.target.files && e.target.files[0]) {
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            appData.background = event.target.result;
                            saveData();
                            loadLogoAndBackground();
                            alert("背景图片上传成功！");
                        };
                        reader.readAsDataURL(e.target.files[0]);
                    }
                };
                input.click();
            }
        }
        
        // 关闭上传弹窗
        function closeUploadModal() {
            document.getElementById("upload-modal").classList.remove("active");
        }
        
        // 处理上传
        function handleUpload(e) {
            e.preventDefault();
            
            if (!passwordVerified) {
                alert("请先验证密码");
                return;
            }
            
            const files = document.getElementById("image-upload").files;
            const title = document.getElementById("image-title").value;
            
            if (files.length === 0) {
                alert("请选择至少一张图片");
                return;
            }
            
            // 检查图片数量限制
            const maxImages = 5;
            if (files.length > maxImages) {
                alert(`最多只能上传${maxImages}张图片`);
                return;
            }
            
            // 检查当前类型已有图片数量
            if (currentUploadType !== "stamp" && appData[currentUploadType].length + files.length > maxImages) {
                alert(`该标签页最多只能有${maxImages}张图片，当前已有${appData[currentUploadType].length}张`);
                return;
            }
            
            // 上传图片
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    const imageData = event.target.result;
                    const now = new Date();
                    const year = now.getFullYear();
                    const month = String(now.getMonth() + 1).padStart(2, '0');
                    const day = String(now.getDate()).padStart(2, '0');
                    const hours = String(now.getHours()).padStart(2, '0');
                    const minutes = String(now.getMinutes()).padStart(2, '0');
                    const dateStr = `${year}年${month}月${day}日 ${hours}:${minutes}`;
                    
                    const item = {
                        id: Date.now() + i, // 简单ID生成
                        image: imageData,
                        date: dateStr
                    };
                    
                    // 如果是公告，添加标题
                    if (currentUploadType === "announcement") {
                        item.title = title || `公告 ${appData[currentUploadType].length + 1}`;
                    }
                    
                    appData[currentUploadType].push(item);
                    saveData();
                    
                    // 如果是最后一张图片，重新渲染
                    if (i === files.length - 1) {
                        renderImages(currentUploadType);
                        closeUploadModal();
                        alert(`成功上传${files.length}张图片`);
                    }
                };
                
                reader.readAsDataURL(file);
            }
        }
        
        // 渲染所有图片
        function renderAllImages() {
            const types = ["announcement", "business", "branches", "pricing", "postage", "products", "stamp"];
            types.forEach(type => renderImages(type));
        }
        
        // 渲染特定类型的图片
        function renderImages(type) {
            const container = document.getElementById(`${type}-images`);
            const items = appData[type];
            
            if (items.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="${getIconForType(type)}"></i>
                        <h3>${getEmptyTextForType(type)}</h3>
                        <p>点击下方按钮上传图片</p>
                    </div>
                `;
                return;
            }
            
            let html = "";
            
            items.forEach(item => {
                html += `
                    <div class="image-item" data-id="${item.id}">
                        <img src="${item.image}" alt="${item.title || '图片'}" onclick="viewImage('${item.image}')">
                        <div class="image-info">
                            ${type === "announcement" ? `<div class="image-title">${item.title || "公告"}</div>` : ""}
                            <div class="image-date">${item.date}</div>
                            <div class="actions" style="margin-top: 10px; justify-content: flex-start;">
                                <button class="btn btn-secondary" onclick="editItem('${type}', ${item.id})" style="padding: 5px 10px; font-size: 12px;">
                                    <i class="fas fa-edit"></i> 修改
                                </button>
                                <button class="btn btn-danger" onclick="deleteItem('${type}', ${item.id})" style="padding: 5px 10px; font-size: 12px; margin-left: 5px;">
                                    <i class="fas fa-trash"></i> 删除
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // 获取类型对应的图标
        function getIconForType(type) {
            const icons = {
                announcement: "far fa-newspaper",
                business: "fas fa-project-diagram",
                branches: "fas fa-store",
                pricing: "fas fa-file-invoice-dollar",
                postage: "fas fa-envelope",
                products: "fas fa-gift",
                stamp: "fas fa-smile-wink"
            };
            return icons[type] || "far fa-image";
        }
        
        // 获取类型对应的空状态文本
        function getEmptyTextForType(type) {
            const texts = {
                announcement: "暂无公告",
                business: "暂无业务介绍",
                branches: "暂无网点信息",
                pricing: "暂无资费信息",
                postage: "暂无邮资信息",
                products: "暂无邮品信息",
                stamp: "暂无戳戳我内容"
            };
            return texts[type] || "暂无内容";
        }
        
        // 查看图片
        function viewImage(imageSrc) {
            document.getElementById("viewed-image").src = imageSrc;
            document.getElementById("image-viewer").classList.add("active");
        }
        
        // 编辑项目
        function editItem(type, id) {
            openPasswordModal();
            
            // 密码验证后打开编辑弹窗
            const originalVerifyPassword = verifyPassword;
            window.tempVerifyPassword = function() {
                const password = document.getElementById("password-input").value;
                if (password === ADMIN_PASSWORD) {
                    passwordVerified = true;
                    closePasswordModal();
                    
                    const items = appData[type];
                    const item = items.find(item => item.id === id);
                    
                    if (!item) {
                        alert("未找到该项目");
                        return;
                    }
                    
                    editingItemId = id;
                    
                    let html = `
                        <div class="form-group">
                            <label>当前图片</label>
                            <div style="text-align: center; margin: 15px 0;">
                                <img src="${item.image}" style="max-width: 100%; max-height: 200px; border-radius: 5px;">
                            </div>
                        </div>
                    `;
                    
                    if (type === "announcement") {
                        html += `
                            <div class="form-group">
                                <label for="edit-title">图片标题</label>
                                <input type="text" id="edit-title" class="form-control" value="${item.title || ''}">
                            </div>
                        `;
                    }
                    
                    html += `
                        <div class="form-group">
                            <label for="edit-image">更换图片 (可选)</label>
                            <input type="file" id="edit-image" class="form-control" accept=".jpg,.jpeg,.png">
                        </div>
                        <div class="actions">
                            <button class="btn btn-primary" onclick="saveEdit('${type}', ${id})">保存修改</button>
                            <button class="btn btn-danger" onclick="confirmDeleteItem('${type}', ${id})">删除此项</button>
                            <button class="btn btn-secondary" onclick="closeEditModal()">取消</button>
                        </div>
                    `;
                    
                    document.getElementById("edit-content").innerHTML = html;
                    document.getElementById("edit-modal").classList.add("active");
                    
                    // 恢复原来的验证函数
                    window.verifyPassword = originalVerifyPassword;
                } else {
                    document.getElementById("password-error").style.display = "block";
                    document.getElementById("password-input").value = "";
                    document.getElementById("password-input").focus();
                }
            };
            
            window.verifyPassword = window.tempVerifyPassword;
        }
        
        // 关闭编辑弹窗
        function closeEditModal() {
            document.getElementById("edit-modal").classList.remove("active");
            editingItemId = null;
        }
        
        // 保存编辑
        function saveEdit(type, id) {
            const items = appData[type];
            const index = items.findIndex(item => item.id === id);
            
            if (index === -1) {
                alert("未找到该项目");
                return;
            }
            
            const item = items[index];
            
            // 更新标题（如果是公告）
            if (type === "announcement") {
                const title = document.getElementById("edit-title").value;
                if (title) {
                    item.title = title;
                }
            }
            
            // 更新图片
            const fileInput = document.getElementById("edit-image");
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    item.image = event.target.result;
                    saveData();
                    renderImages(type);
                    closeEditModal();
                    alert("修改成功！");
                };
                
                reader.readAsDataURL(file);
            } else {
                saveData();
                renderImages(type);
                closeEditModal();
                alert("修改成功！");
            }
        }
        
        // 删除项目
        function deleteItem(type, id) {
            if (confirm("确定要删除这个项目吗？")) {
                appData[type] = appData[type].filter(item => item.id !== id);
                saveData();
                renderImages(type);
                alert("删除成功！");
            }
        }
        
        // 确认删除项目（从编辑弹窗）
        function confirmDeleteItem(type, id) {
            if (confirm("确定要删除这个项目吗？")) {
                appData[type] = appData[type].filter(item => item.id !== id);
                saveData();
                renderImages(type);
                closeEditModal();
                alert("删除成功！");
            }
        }
        
        // 删除LOGO
        function deleteLogo() {
            if (confirm("确定要删除LOGO吗？")) {
                appData.logo = "";
                saveData();
                loadLogoAndBackground();
                alert("LOGO已删除");
            }
        }
        
        // 删除背景
        function deleteBackground() {
            if (confirm("确定要删除背景图片吗？")) {
                appData.background = "";
                saveData();
                loadLogoAndBackground();
                alert("背景图片已删除");
            }
        }
        
        // 加载LOGO和背景
        function loadLogoAndBackground() {
            const logoImg = document.getElementById("logo-img");
            const currentLogo = document.getElementById("current-logo");
            const backgroundImg = document.getElementById("current-background");
            const body = document.body;
            
            if (appData.logo) {
                logoImg.src = appData.logo;
                currentLogo.src = appData.logo;
                logoImg.style.display = "block";
            } else {
                logoImg.style.display = "none";
                currentLogo.src = "";
                currentLogo.style.display = "none";
                document.querySelector(".current-image p").textContent = "未设置LOGO";
            }
            
            if (appData.background) {
                body.style.backgroundImage = `url('${appData.background}')`;
                backgroundImg.src = appData.background;
                backgroundImg.style.display = "block";
            } else {
                body.style.backgroundImage = "";
                backgroundImg.src = "";
                backgroundImg.style.display = "none";
                document.querySelectorAll(".current-image p")[1].textContent = "未设置背景";
            }
        }
        
        // 页面加载完成后初始化
        document.addEventListener("DOMContentLoaded", initApp);
        
        // 添加示例数据函数
        function addSampleData() {
            // 只有首次访问时添加示例数据
            if (!localStorage.getItem("lyonPostal_hasSampleData")) {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                const day = String(now.getDate()).padStart(2, '0');
                const hours = String(now.getHours()).padStart(2, '0');
                const minutes = String(now.getMinutes()).padStart(2, '0');
                const dateStr = `${year}年${month}月${day}日 ${hours}:${minutes}`;
                
                // 添加公告示例
                appData.announcement.push({
                    id: 1,
                    image: "https://images.unsplash.com/photo-1563986768494-4dee2763ff3f?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    title: "某某公告",
                    date: "2023-12-28 10:30"
                });
                
                // 添加业务介绍示例
                appData.business.push({
                    id: 2,
                    image: "https://images.unsplash.com/photo-1556761175-b413da4baf72?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    date: "2023-12-20 14:20"
                });
                
                // 添加网点清单示例
                appData.branches.push({
                    id: 3,
                    image: "https://images.unsplash.com/photo-1586528116311-ad8dd3c8310d?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    date: "2023-12-15 09:15"
                });
                
                // 添加资费清单示例
                appData.pricing.push({
                    id: 4,
                    image: "https://images.unsplash.com/photo-1554224155-8d04cb21cd6c?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    date: "2023-12-10 16:45"
                });
                
                // 添加戳戳我示例
                appData.stamp.push({
                    id: 5,
                    image: "https://images.unsplash.com/photo-1564501049418-3c27787d01e8?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",
                    date: "2023-12-05 11:30"
                });
                
                // 保存数据
                saveData();
                localStorage.setItem("lyonPostal_hasSampleData", "true");
                
                // 重新渲染
                renderAllImages();
            }
        }
        
        // 页面加载后添加示例数据
        window.addEventListener("load", addSampleData);
    </script>
</body>
</html>
