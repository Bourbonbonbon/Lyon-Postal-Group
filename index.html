<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>里昂邮政集团</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            min-height: 100vh;
            transition: background 0.3s;
        }

        #background-image {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -1;
            opacity: 0.9;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: linear-gradient(135deg, #1e5799 0%, #207cca 51%, #2989d8 100%);
            color: white;
            padding: 15px 30px;
            border-radius: 12px;
            margin-bottom: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        #site-logo {
            width: 75px;
            height: 75px;
            object-fit: contain;
            border-radius: 8px;
            border: 3px solid white;
            cursor: pointer;
            transition: transform 0.3s;
        }

        #site-logo:hover {
            transform: scale(1.05);
        }

        .company-name {
            font-size: 32px;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .tabs-container {
            display: flex;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            min-width: 120px;
            text-align: center;
            padding: 18px 10px;
            font-size: 16px;
            font-weight: 600;
            color: #555;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 4px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .tab:hover {
            background-color: #f8f9fa;
            color: #1e5799;
        }

        .tab.active {
            background-color: #e9f2ff;
            color: #1e5799;
            border-bottom: 4px solid #1e5799;
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.05);
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .tab-content.active {
            display: block;
        }

        .tab-title {
            font-size: 26px;
            color: #1e5799;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #eaeaea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .images-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .image-item {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .image-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }

        .image-item img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            cursor: pointer;
            display: block;
        }

        .image-info {
            padding: 15px;
        }

        .image-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .image-date {
            font-size: 14px;
            color: #777;
        }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(to right, #1e5799, #207cca);
            color: white;
        }

        .btn-primary:hover {
            background: linear-gradient(to right, #18467e, #1c6cb0);
            box-shadow: 0 5px 15px rgba(30, 87, 153, 0.3);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #555;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .empty-message {
            text-align: center;
            padding: 40px 20px;
            color: #888;
            font-size: 18px;
            grid-column: 1 / -1;
        }

        .empty-message i {
            font-size: 48px;
            margin-bottom: 15px;
            color: #ccc;
        }

        /* 模态框样式 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            animation: slideUp 0.4s;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .modal-header {
            padding: 20px 25px;
            background: linear-gradient(to right, #1e5799, #207cca);
            color: white;
            border-radius: 12px 12px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 22px;
        }

        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            line-height: 1;
        }

        .modal-body {
            padding: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border 0.3s;
        }

        .form-group input:focus, .form-group textarea:focus {
            border-color: #1e5799;
            outline: none;
        }

        .password-input {
            letter-spacing: 3px;
            font-family: monospace;
        }

        .file-input-container {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-input-container:hover {
            border-color: #1e5799;
            background-color: #f9fbfe;
        }

        .file-input {
            display: none;
        }

        .file-input-label {
            display: block;
            font-size: 18px;
            color: #555;
            cursor: pointer;
        }

        .file-input-label i {
            font-size: 48px;
            color: #1e5799;
            margin-bottom: 15px;
            display: block;
        }

        .file-preview {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .file-preview-item {
            width: 80px;
            height: 80px;
            border-radius: 6px;
            overflow: hidden;
            position: relative;
        }

        .file-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .remove-file {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            font-size: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-footer {
            padding: 20px 25px;
            background: #f8f9fa;
            border-radius: 0 0 12px 12px;
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }

        /* 图片放大查看样式 */
        .image-viewer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s;
        }

        .image-viewer.active {
            display: flex;
        }

        .image-viewer img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            border-radius: 5px;
        }

        .close-viewer {
            position: absolute;
            top: 20px;
            right: 30px;
            background: none;
            border: none;
            color: white;
            font-size: 36px;
            cursor: pointer;
        }

        /* 设置页样式 */
        .settings-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
        }

        .setting-card {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }

        .setting-card h3 {
            color: #1e5799;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eaeaea;
        }

        .current-image {
            text-align: center;
            margin-bottom: 20px;
        }

        .current-image img {
            max-width: 100%;
            max-height: 200px;
            border-radius: 8px;
            border: 2px solid #ddd;
            cursor: pointer;
        }

        .image-size-note {
            font-size: 14px;
            color: #777;
            margin-top: 10px;
        }

        /* 响应式调整 */
        @media (max-width: 992px) {
            .tabs-container {
                overflow-x: auto;
                flex-wrap: nowrap;
            }
            
            .tab {
                min-width: 110px;
                padding: 15px 8px;
                font-size: 15px;
            }
            
            .images-container {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            }
        }

        @media (max-width: 768px) {
            header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .tab {
                min-width: 100px;
                padding: 12px 5px;
                font-size: 14px;
            }
            
            .tab-content {
                padding: 20px;
            }
            
            .images-container {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 15px;
            }
            
            .settings-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .company-name {
                font-size: 26px;
            }
            
            .tab {
                min-width: 90px;
                font-size: 13px;
            }
            
            .images-container {
                grid-template-columns: 1fr;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <!-- 背景图片 -->
    <img id="background-image" src="" alt="背景">
    
    <div class="container">
        <header>
            <div class="logo-container">
                <img id="site-logo" src="" alt="里昂邮政集团LOGO">
                <div class="company-name">里昂邮政集团</div>
            </div>
            <div class="header-info">安全 · 高效 · 可靠</div>
        </header>
        
        <div class="tabs-container">
            <div class="tab active" data-tab="announcement">公告</div>
            <div class="tab" data-tab="business">业务介绍</div>
            <div class="tab" data-tab="branches">网点清单</div>
            <div class="tab" data-tab="fees">资费清单</div>
            <div class="tab" data-tab="postage">邮资清单</div>
            <div class="tab" data-tab="products">邮品清单</div>
            <div class="tab" data-tab="settings">设置</div>
            <div class="tab" data-tab="contact">戳戳我</div>
        </div>
        
        <!-- 公告标签页 -->
        <div id="announcement" class="tab-content active">
            <div class="tab-title">
                <span>集团公告</span>
                <button class="btn btn-primary" id="add-announcement">
                    <i class="fas fa-plus"></i> 添加公告
                </button>
            </div>
            
            <div class="images-container" id="announcement-container">
                <!-- 公告内容将通过JavaScript动态生成 -->
                <div class="empty-message">
                    <i class="fas fa-bullhorn"></i>
                    <p>暂无公告，点击"添加公告"按钮上传</p>
                </div>
            </div>
        </div>
        
        <!-- 业务介绍标签页 -->
        <div id="business" class="tab-content">
            <div class="tab-title">
                <span>业务介绍</span>
                <button class="btn btn-primary" id="add-business">
                    <i class="fas fa-plus"></i> 添加业务介绍
                </button>
            </div>
            
            <div class="images-container" id="business-container">
                <div class="empty-message">
                    <i class="fas fa-briefcase"></i>
                    <p>暂无业务介绍，点击"添加业务介绍"按钮上传</p>
                </div>
            </div>
        </div>
        
        <!-- 网点清单标签页 -->
        <div id="branches" class="tab-content">
            <div class="tab-title">
                <span>网点清单</span>
                <button class="btn btn-primary" id="add-branch">
                    <i class="fas fa-plus"></i> 添加网点清单
                </button>
            </div>
            
            <div class="images-container" id="branches-container">
                <div class="empty-message">
                    <i class="fas fa-map-marker-alt"></i>
                    <p>暂无网点清单，点击"添加网点清单"按钮上传</p>
                </div>
            </div>
        </div>
        
        <!-- 资费清单标签页 -->
        <div id="fees" class="tab-content">
            <div class="tab-title">
                <span>资费清单</span>
                <button class="btn btn-primary" id="add-fee">
                    <i class="fas fa-plus"></i> 添加资费清单
                </button>
            </div>
            
            <div class="images-container" id="fees-container">
                <div class="empty-message">
                    <i class="fas fa-money-bill-wave"></i>
                    <p>暂无资费清单，点击"添加资费清单"按钮上传</p>
                </div>
            </div>
        </div>
        
        <!-- 邮资清单标签页 -->
        <div id="postage" class="tab-content">
            <div class="tab-title">
                <span>邮资清单</span>
                <button class="btn btn-primary" id="add-postage">
                    <i class="fas fa-plus"></i> 添加邮资清单
                </button>
            </div>
            
            <div class="images-container" id="postage-container">
                <div class="empty-message">
                    <i class="fas fa-stamp"></i>
                    <p>暂无邮资清单，点击"添加邮资清单"按钮上传</p>
                </div>
            </div>
        </div>
        
        <!-- 邮品清单标签页 -->
        <div id="products" class="tab-content">
            <div class="tab-title">
                <span>邮品清单</span>
                <button class="btn btn-primary" id="add-product">
                    <i class="fas fa-plus"></i> 添加邮品清单
                </button>
            </div>
            
            <div class="images-container" id="products-container">
                <div class="empty-message">
                    <i class="fas fa-box-open"></i>
                    <p>暂无邮品清单，点击"添加邮品清单"按钮上传</p>
                </div>
            </div>
        </div>
        
        <!-- 设置标签页 -->
        <div id="settings" class="tab-content">
            <div class="tab-title">
                <span>系统设置</span>
            </div>
            
            <div class="settings-container">
                <div class="setting-card">
                    <h3>LOGO设置</h3>
                    <div class="current-image">
                        <p>当前LOGO：</p>
                        <img id="current-logo" src="" alt="当前LOGO">
                        <p class="image-size-note">建议尺寸：75cm × 75cm</p>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary" id="upload-logo">
                            <i class="fas fa-upload"></i> 上传LOGO
                        </button>
                        <button class="btn btn-danger" id="remove-logo">
                            <i class="fas fa-trash"></i> 删除LOGO
                        </button>
                    </div>
                </div>
                
                <div class="setting-card">
                    <h3>背景设置</h3>
                    <div class="current-image">
                        <p>当前背景：</p>
                        <img id="current-background" src="" alt="当前背景">
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-primary" id="upload-background">
                            <i class="fas fa-upload"></i> 上传背景
                        </button>
                        <button class="btn btn-danger" id="remove-background">
                            <i class="fas fa-trash"></i> 删除背景
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 戳戳我标签页 -->
        <div id="contact" class="tab-content">
            <div class="tab-title">
                <span>戳戳我</span>
                <button class="btn btn-primary" id="add-contact">
                    <i class="fas fa-plus"></i> 添加内容
                </button>
            </div>
            
            <div class="images-container" id="contact-container">
                <div class="empty-message">
                    <i class="fas fa-hand-point-up"></i>
                    <p>暂无内容，点击"添加内容"按钮上传</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 图片上传模态框 -->
    <div id="upload-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modal-title">上传内容</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="password">请输入管理密码</label>
                    <input type="password" id="password" class="password-input" placeholder="请输入密码">
                    <div id="password-error" style="color: #e74c3c; font-size: 14px; margin-top: 5px; display: none;">
                        密码错误，请重新输入
                    </div>
                </div>
                
                <div id="upload-form" style="display: none;">
                    <div class="form-group">
                        <label for="image-title">标题</label>
                        <input type="text" id="image-title" placeholder="请输入图片标题">
                    </div>
                    
                    <div class="form-group">
                        <label>上传图片 (最多5张)</label>
                        <div class="file-input-container" id="drop-area">
                            <input type="file" id="file-input" class="file-input" accept="image/jpeg, image/jpg, image/png" multiple>
                            <label for="file-input" class="file-input-label">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <span>点击选择图片或拖拽图片到此处</span>
                                <p style="margin-top: 10px; font-size: 14px; color: #888;">支持格式: JPG, JPEG, PNG</p>
                            </label>
                        </div>
                        
                        <div class="file-preview" id="file-preview">
                            <!-- 文件预览区域 -->
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary close-modal">取消</button>
                <button class="btn btn-primary" id="submit-btn">提交</button>
            </div>
        </div>
    </div>
    
    <!-- 图片查看器 -->
    <div id="image-viewer" class="image-viewer">
        <button class="close-viewer">&times;</button>
        <img id="viewed-image" src="" alt="大图预览">
    </div>
    
    <script>
        // 全局变量
        const DEFAULT_PASSWORD = "740302";
        const TABS = [
            "announcement", "business", "branches", "fees", 
            "postage", "products", "settings", "contact"
        ];
        
        let currentTab = localStorage.getItem("currentTab") || "announcement";
        let currentUploadType = null;
        let uploadedFiles = [];
        let editingItemId = null;
        
        // DOM元素
        const tabElements = document.querySelectorAll(".tab");
        const tabContentElements = document.querySelectorAll(".tab-content");
        const uploadModal = document.getElementById("upload-modal");
        const modalTitle = document.getElementById("modal-title");
        const passwordInput = document.getElementById("password");
        const passwordError = document.getElementById("password-error");
        const uploadForm = document.getElementById("upload-form");
        const fileInput = document.getElementById("file-input");
        const filePreview = document.getElementById("file-preview");
        const dropArea = document.getElementById("drop-area");
        const submitBtn = document.getElementById("submit-btn");
        const closeModalBtns = document.querySelectorAll(".close-modal");
        const imageViewer = document.getElementById("image-viewer");
        const closeViewerBtn = document.querySelector(".close-viewer");
        const viewedImage = document.getElementById("viewed-image");
        
        // 初始化
        document.addEventListener("DOMContentLoaded", function() {
            initializeApp();
            loadAllData();
            setupEventListeners();
        });
        
        // 初始化应用
        function initializeApp() {
            // 设置当前活动标签
            setActiveTab(currentTab);
            
            // 初始化LOGO和背景
            const savedLogo = localStorage.getItem("siteLogo");
            const savedBackground = localStorage.getItem("siteBackground");
            
            if (savedLogo) {
                document.getElementById("site-logo").src = savedLogo;
                document.getElementById("current-logo").src = savedLogo;
            }
            
            if (savedBackground) {
                document.getElementById("background-image").src = savedBackground;
                document.getElementById("current-background").src = savedBackground;
            }
        }
        
        // 设置事件监听器
        function setupEventListeners() {
            // 标签切换
            tabElements.forEach(tab => {
                tab.addEventListener("click", function() {
                    const tabId = this.getAttribute("data-tab");
                    setActiveTab(tabId);
                    localStorage.setItem("currentTab", tabId);
                });
            });
            
            // 添加按钮点击事件
            document.getElementById("add-announcement").addEventListener("click", () => openUploadModal("announcement"));
            document.getElementById("add-business").addEventListener("click", () => openUploadModal("business"));
            document.getElementById("add-branch").addEventListener("click", () => openUploadModal("branches"));
            document.getElementById("add-fee").addEventListener("click", () => openUploadModal("fees"));
            document.getElementById("add-postage").addEventListener("click", () => openUploadModal("postage"));
            document.getElementById("add-product").addEventListener("click", () => openUploadModal("products"));
            document.getElementById("add-contact").addEventListener("click", () => openUploadModal("contact"));
            
            // 设置页面按钮事件
            document.getElementById("upload-logo").addEventListener("click", () => openLogoUpload());
            document.getElementById("remove-logo").addEventListener("click", removeLogo);
            document.getElementById("upload-background").addEventListener("click", () => openBackgroundUpload());
            document.getElementById("remove-background").addEventListener("click", removeBackground);
            
            // 模态框关闭事件
            closeModalBtns.forEach(btn => {
                btn.addEventListener("click", closeUploadModal);
            });
            
            // 文件选择事件
            fileInput.addEventListener("change", handleFileSelect);
            
            // 拖放事件
            dropArea.addEventListener("dragover", function(e) {
                e.preventDefault();
                this.style.borderColor = "#1e5799";
                this.style.backgroundColor = "#f0f7ff";
            });
            
            dropArea.addEventListener("dragleave", function(e) {
                e.preventDefault();
                this.style.borderColor = "#ccc";
                this.style.backgroundColor = "";
            });
            
            dropArea.addEventListener("drop", function(e) {
                e.preventDefault();
                this.style.borderColor = "#ccc";
                this.style.backgroundColor = "";
                
                const files = e.dataTransfer.files;
                handleFiles(files);
            });
            
            // 提交按钮事件
            submitBtn.addEventListener("click", handleSubmit);
            
            // 图片查看器关闭事件
            closeViewerBtn.addEventListener("click", closeImageViewer);
            
            // 点击模态框外部关闭
            uploadModal.addEventListener("click", function(e) {
                if (e.target === this) {
                    closeUploadModal();
                }
            });
            
            // 点击图片查看器外部关闭
            imageViewer.addEventListener("click", function(e) {
                if (e.target === this) {
                    closeImageViewer();
                }
            });
        }
        
        // 设置活动标签
        function setActiveTab(tabId) {
            // 更新标签
            tabElements.forEach(tab => {
                if (tab.getAttribute("data-tab") === tabId) {
                    tab.classList.add("active");
                } else {
                    tab.classList.remove("active");
                }
            });
            
            // 更新内容区域
            tabContentElements.forEach(content => {
                if (content.id === tabId) {
                    content.classList.add("active");
                } else {
                    content.classList.remove("active");
                }
            });
            
            currentTab = tabId;
        }
        
        // 打开上传模态框
        function openUploadModal(type) {
            currentUploadType = type;
            editingItemId = null;
            
            // 设置模态框标题
            const titles = {
                announcement: "上传公告",
                business: "上传业务介绍",
                branches: "上传网点清单",
                fees: "上传资费清单",
                postage: "上传邮资清单",
                products: "上传邮品清单",
                contact: "上传内容"
            };
            
            modalTitle.textContent = titles[type] || "上传内容";
            
            // 重置表单
            resetUploadForm();
            
            // 显示模态框
            uploadModal.classList.add("active");
            passwordInput.focus();
        }
        
        // 打开LOGO上传
        function openLogoUpload() {
            openPasswordPrompt("logo");
        }
        
        // 打开背景上传
        function openBackgroundUpload() {
            openPasswordPrompt("background");
        }
        
        // 打开密码提示
        function openPasswordPrompt(type) {
            currentUploadType = type;
            
            // 设置模态框标题
            modalTitle.textContent = type === "logo" ? "上传LOGO" : "上传背景";
            
            // 重置表单
            resetUploadForm();
            
            // 显示模态框
            uploadModal.classList.add("active");
            passwordInput.focus();
        }
        
        // 重置上传表单
        function resetUploadForm() {
            passwordInput.value = "";
            passwordError.style.display = "none";
            uploadForm.style.display = "none";
            document.getElementById("image-title").value = "";
            uploadedFiles = [];
            filePreview.innerHTML = "";
            submitBtn.textContent = "提交";
        }
        
        // 关闭上传模态框
        function closeUploadModal() {
            uploadModal.classList.remove("active");
            resetUploadForm();
        }
        
        // 处理密码输入
        function checkPassword() {
            const password = passwordInput.value.trim();
            
            if (password === DEFAULT_PASSWORD) {
                passwordError.style.display = "none";
                
                // 如果是LOGO或背景上传，直接显示文件上传
                if (currentUploadType === "logo" || currentUploadType === "background") {
                    showFileUpload();
                } else {
                    // 其他类型显示完整表单
                    uploadForm.style.display = "block";
                    document.getElementById("image-title").focus();
                }
                
                return true;
            } else {
                passwordError.style.display = "block";
                passwordInput.focus();
                return false;
            }
        }
        
        // 显示文件上传区域
        function showFileUpload() {
            uploadForm.style.display = "block";
            
            // 如果是LOGO或背景，隐藏标题输入
            if (currentUploadType === "logo" || currentUploadType === "background") {
                document.querySelector("label[for='image-title']").parentElement.style.display = "none";
            } else {
                document.querySelector("label[for='image-title']").parentElement.style.display = "block";
            }
        }
        
        // 处理文件选择
        function handleFileSelect(e) {
            const files = e.target.files;
            handleFiles(files);
        }
        
        // 处理文件
        function handleFiles(files) {
            // 检查文件数量
            if (uploadedFiles.length + files.length > 5) {
                alert("最多只能上传5张图片");
                return;
            }
            
            // 处理每个文件
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                // 检查文件类型
                if (!file.type.match("image/jpeg") && 
                    !file.type.match("image/jpg") && 
                    !file.type.match("image/png")) {
                    alert("只支持JPG、JPEG、PNG格式的图片");
                    continue;
                }
                
                // 添加到上传文件列表
                uploadedFiles.push(file);
                
                // 创建预览
                createFilePreview(file);
            }
            
            // 重置文件输入
            fileInput.value = "";
        }
        
        // 创建文件预览
        function createFilePreview(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const previewItem = document.createElement("div");
                previewItem.className = "file-preview-item";
                
                const img = document.createElement("img");
                img.src = e.target.result;
                img.alt = "预览";
                
                const removeBtn = document.createElement("button");
                removeBtn.className = "remove-file";
                removeBtn.innerHTML = "&times;";
                removeBtn.onclick = function() {
                    // 从上传文件列表中移除
                    const index = uploadedFiles.indexOf(file);
                    if (index > -1) {
                        uploadedFiles.splice(index, 1);
                    }
                    
                    // 从预览中移除
                    previewItem.remove();
                };
                
                previewItem.appendChild(img);
                previewItem.appendChild(removeBtn);
                filePreview.appendChild(previewItem);
            };
            
            reader.readAsDataURL(file);
        }
        
        // 处理提交
        function handleSubmit() {
            // 首先检查密码
            if (!checkPassword()) {
                return;
            }
            
            // 验证表单
            if (currentUploadType !== "logo" && currentUploadType !== "background") {
                const title = document.getElementById("image-title").value.trim();
                if (!title) {
                    alert("请输入标题");
                    document.getElementById("image-title").focus();
                    return;
                }
            }
            
            if (uploadedFiles.length === 0) {
                alert("请至少上传一张图片");
                return;
            }
            
            // 处理提交
            if (currentUploadType === "logo") {
                handleLogoUpload();
            } else if (currentUploadType === "background") {
                handleBackgroundUpload();
            } else {
                handleContentUpload();
            }
        }
        
            // 处理LOGO上传
    function handleLogoUpload() {
        const file = uploadedFiles[0]; // LOGO只取第一张
        const reader = new FileReader();
        
        reader.onload = function(e) {
            const logoDataUrl = e.target.result;
            
            // 保存到localStorage
            localStorage.setItem("siteLogo", logoDataUrl);
            
            // 更新页面显示
            document.getElementById("site-logo").src = logoDataUrl;
            document.getElementById("current-logo").src = logoDataUrl;
            
            alert("LOGO上传成功！");
            closeUploadModal();
        };
        
        reader.readAsDataURL(file);
    }
    
    // 处理背景上传
    function handleBackgroundUpload() {
        const file = uploadedFiles[0]; // 背景只取第一张
        const reader = new FileReader();
        
        reader.onload = function(e) {
            const backgroundDataUrl = e.target.result;
            
            // 保存到localStorage
            localStorage.setItem("siteBackground", backgroundDataUrl);
            
            // 更新页面显示
            document.getElementById("background-image").src = backgroundDataUrl;
            document.getElementById("current-background").src = backgroundDataUrl;
            
            alert("背景图片上传成功！");
            closeUploadModal();
        };
        
        reader.readAsDataURL(file);
    }
    
    // 处理内容上传
    function handleContentUpload() {
        const title = document.getElementById("image-title").value.trim();
        const date = getCurrentDateTime();
        
        // 读取所有上传的文件
        const readers = uploadedFiles.map(file => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    resolve({
                        dataUrl: e.target.result,
                        name: file.name
                    });
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        });
        
        // 所有文件读取完成后保存数据
        Promise.all(readers).then(fileData => {
            const newItem = {
                id: editingItemId || Date.now().toString(),
                title: title,
                date: date,
                images: fileData.map(f => f.dataUrl)
            };
            
            // 保存数据到localStorage
            saveContentItem(currentUploadType, newItem, editingItemId !== null);
            
            // 重新加载数据
            loadTabData(currentUploadType);
            
            alert(editingItemId ? "内容修改成功！" : "内容上传成功！");
            closeUploadModal();
        });
    }
    
    // 保存内容项
    function saveContentItem(type, item, isEdit = false) {
        const key = `lyonPost_${type}`;
        let items = JSON.parse(localStorage.getItem(key)) || [];
        
        if (isEdit) {
            // 修改现有项
            const index = items.findIndex(i => i.id === item.id);
            if (index !== -1) {
                items[index] = item;
            }
        } else {
            // 添加新项
            items.unshift(item); // 新项放在最前面
        }
        
        localStorage.setItem(key, JSON.stringify(items));
    }
    
    // 删除内容项
    function deleteContentItem(type, id) {
        if (!confirm("确定要删除此项吗？")) {
            return;
        }
        
        const key = `lyonPost_${type}`;
        let items = JSON.parse(localStorage.getItem(key)) || [];
        items = items.filter(item => item.id !== id);
        localStorage.setItem(key, JSON.stringify(items));
        
        // 重新加载数据
        loadTabData(type);
    }
    
    // 编辑内容项
    function editContentItem(type, id) {
        const key = `lyonPost_${type}`;
        const items = JSON.parse(localStorage.getItem(key)) || [];
        const item = items.find(i => i.id === id);
        
        if (!item) return;
        
        currentUploadType = type;
        editingItemId = id;
        
        // 设置模态框标题
        const titles = {
            announcement: "修改公告",
            business: "修改业务介绍",
            branches: "修改网点清单",
            fees: "修改资费清单",
            postage: "修改邮资清单",
            products: "修改邮品清单",
            contact: "修改内容"
        };
        
        modalTitle.textContent = titles[type] || "修改内容";
        
        // 设置表单值
        document.getElementById("image-title").value = item.title;
        
        // 清空文件预览
        uploadedFiles = [];
        filePreview.innerHTML = "";
        
        // 添加现有图片到预览
        item.images.forEach(imageDataUrl => {
            // 将base64转换为blob以便预览
            fetch(imageDataUrl)
                .then(res => res.blob())
                .then(blob => {
                    const file = new File([blob], `image_${Date.now()}.png`, { type: blob.type });
                    uploadedFiles.push(file);
                    createFilePreview(file);
                });
        });
        
        // 显示模态框
        uploadModal.classList.add("active");
        passwordInput.focus();
    }
    
    // 加载所有数据
    function loadAllData() {
        TABS.forEach(tab => {
            if (tab !== "settings") {
                loadTabData(tab);
            }
        });
    }
    
    // 加载标签页数据
    function loadTabData(type) {
        const key = `lyonPost_${type}`;
        const items = JSON.parse(localStorage.getItem(key)) || [];
        const container = document.getElementById(`${type}-container`);
        
        if (items.length === 0) {
            container.innerHTML = `
                <div class="empty-message">
                    <i class="${getTabIcon(type)}"></i>
                    <p>${getEmptyMessage(type)}</p>
                </div>
            `;
            return;
        }
        
        // 生成内容HTML
        let html = '';
        items.forEach(item => {
            const firstImage = item.images[0];
            html += `
                <div class="image-item" data-id="${item.id}">
                    <img src="${firstImage}" alt="${item.title}" onclick="viewImage('${firstImage}')">
                    <div class="image-info">
                        <div class="image-title">${item.title}</div>
                        <div class="image-date">上传时间: ${item.date}</div>
                        <div class="action-buttons" style="margin-top: 10px; justify-content: flex-start;">
                            <button class="btn btn-secondary" onclick="editContentItem('${type}', '${item.id}')" style="padding: 8px 12px; font-size: 14px;">
                                <i class="fas fa-edit"></i> 修改
                            </button>
                            <button class="btn btn-danger" onclick="deleteContentItem('${type}', '${item.id}')" style="padding: 8px 12px; font-size: 14px;">
                                <i class="fas fa-trash"></i> 删除
                            </button>
                        </div>
                    </div>
                </div>
            `;
        });
        
        container.innerHTML = html;
    }
    
    // 获取标签页图标
    function getTabIcon(type) {
        const icons = {
            announcement: "fas fa-bullhorn",
            business: "fas fa-briefcase",
            branches: "fas fa-map-marker-alt",
            fees: "fas fa-money-bill-wave",
            postage: "fas fa-stamp",
            products: "fas fa-box-open",
            contact: "fas fa-hand-point-up"
        };
        return icons[type] || "fas fa-image";
    }
    
    // 获取空数据提示信息
    function getEmptyMessage(type) {
        const messages = {
            announcement: "暂无公告，点击\"添加公告\"按钮上传",
            business: "暂无业务介绍，点击\"添加业务介绍\"按钮上传",
            branches: "暂无网点清单，点击\"添加网点清单\"按钮上传",
            fees: "暂无资费清单，点击\"添加资费清单\"按钮上传",
            postage: "暂无邮资清单，点击\"添加邮资清单\"按钮上传",
            products: "暂无邮品清单，点击\"添加邮品清单\"按钮上传",
            contact: "暂无内容，点击\"添加内容\"按钮上传"
        };
        return messages[type] || "暂无内容";
    }
    
    // 获取当前日期时间
    function getCurrentDateTime() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hour = String(now.getHours()).padStart(2, '0');
        const minute = String(now.getMinutes()).padStart(2, '0');
        
        return `${year}年${month}月${day}日 ${hour}:${minute}`;
    }
    
    // 查看图片大图
    function viewImage(src) {
        viewedImage.src = src;
        imageViewer.classList.add("active");
    }
    
    // 关闭图片查看器
    function closeImageViewer() {
        imageViewer.classList.remove("active");
        viewedImage.src = "";
    }
    
    // 删除LOGO
    function removeLogo() {
        if (!confirm("确定要删除LOGO吗？")) {
            return;
        }
        
        localStorage.removeItem("siteLogo");
        document.getElementById("site-logo").src = "";
        document.getElementById("current-logo").src = "";
        
        alert("LOGO已删除");
    }
    
    // 删除背景
    function removeBackground() {
        if (!confirm("确定要删除背景图片吗？")) {
            return;
        }
        
        localStorage.removeItem("siteBackground");
        document.getElementById("background-image").src = "";
        document.getElementById("current-background").src = "";
        
        alert("背景图片已删除");
    }
    
    // 密码输入框回车事件
    passwordInput.addEventListener("keyup", function(e) {
        if (e.key === "Enter") {
            if (uploadForm.style.display === "none") {
                checkPassword();
            } else {
                handleSubmit();
            }
        }
    });
    
    // 图片标题输入框回车事件
    document.getElementById("image-title").addEventListener("keyup", function(e) {
        if (e.key === "Enter") {
            handleSubmit();
        }
    });
    
    // 暴露函数到全局作用域，以便HTML中调用
    window.viewImage = viewImage;
    window.editContentItem = editContentItem;
    window.deleteContentItem = deleteContentItem;
</script>
